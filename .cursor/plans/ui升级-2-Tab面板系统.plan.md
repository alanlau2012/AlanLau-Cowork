---
name: UIå‡çº§å­Plan 2 - Tabé¢æ¿ç³»ç»Ÿ
overview: å³ä¾§è¾¹æ å‡çº§ä¸ºTabé¢æ¿ï¼ˆè¿›åº¦/å·¥å…·/æ–‡ä»¶ï¼‰ï¼ŒåŒ…å«å®Œæ•´çš„CSSæ ·å¼ã€HTMLç»“æ„ã€ARIAå¯è®¿é—®æ€§å±æ€§å’ŒJavaScriptäº¤äº’é€»è¾‘ã€‚
todos:
  - id: p3-tab-nav
    content: 'P3.1: æ·»åŠ  .panel-tabs å¯¼èˆªæ ·å¼ [éªŒæ”¶: Tab æŒ‰é’®æ’åˆ—æ­£ç¡®]'
    status: pending
  - id: p3-tab-active
    content: 'P3.2: æ·»åŠ  Tab æ¿€æ´»çŠ¶æ€å’Œä¸‹åˆ’çº¿ [éªŒæ”¶: é€‰ä¸­æ€æœ‰ä¸‹åˆ’çº¿]'
    status: pending
  - id: p3-tab-pane
    content: 'P3.3: æ·»åŠ  .tab-pane å†…å®¹åŒºæ ·å¼ [éªŒæ”¶: åˆ‡æ¢æ—¶éšè—/æ˜¾ç¤º]'
    status: pending
  - id: p3-progress-summary
    content: 'P3.4: æ·»åŠ è¿›åº¦æ‘˜è¦æ ·å¼ [éªŒæ”¶: è¿›åº¦æ¡æ­£ç¡®æ˜¾ç¤º]'
    status: pending
  - id: p3-file-change
    content: 'P3.5: æ·»åŠ æ–‡ä»¶å˜æ›´åˆ—è¡¨æ ·å¼ [éªŒæ”¶: å¢åˆ æ”¹æœ‰ä¸åŒé¢œè‰²]'
    status: pending
  - id: p8-tabs-structure
    content: 'P8.1: æ·»åŠ  panel-tabs å¯¼èˆªç»“æ„ + ARIA å±æ€§ [éªŒæ”¶: role=tablist]'
    status: pending
  - id: p8-progress-pane
    content: 'P8.2: æ·»åŠ è¿›åº¦ Tab å†…å®¹åŒº [éªŒæ”¶: id=pane-progress]'
    status: pending
  - id: p8-tools-pane
    content: 'P8.3: æ·»åŠ å·¥å…·è°ƒç”¨ Tab å†…å®¹åŒº [éªŒæ”¶: id=pane-tools]'
    status: pending
  - id: p8-files-pane
    content: 'P8.4: æ·»åŠ æ–‡ä»¶å˜æ›´ Tab å†…å®¹åŒº [éªŒæ”¶: id=pane-files]'
    status: pending
  - id: p9-empty-files
    content: 'P9.2: æ·»åŠ æ–‡ä»¶å˜æ›´ç©ºçŠ¶æ€ [éªŒæ”¶: æ— å˜æ›´æ—¶æ˜¾ç¤ºæç¤º]'
    status: pending
  - id: p11-switch-tab
    content: 'P11.1: å®ç° switchTab() åˆ‡æ¢é€»è¾‘ [éªŒæ”¶: Tab åˆ‡æ¢æ­£å¸¸]'
    status: pending
  - id: p11-tab-a11y
    content: 'P11.2: æ·»åŠ  Tab é”®ç›˜å¯¼èˆª (æ–¹å‘é”®) [éªŒæ”¶: é”®ç›˜å¯åˆ‡æ¢ Tab]'
    status: pending
  - id: p11-tab-scroll-pos
    content: 'P11.3: å®ç° Tab æ»šåŠ¨ä½ç½®ä¿æŒ [éªŒæ”¶: åˆ‡æ¢å›æ¥ä½ç½®ä¸å˜]'
    status: pending
  - id: p11-tab-badge
    content: 'P11.4: å®ç° Tab Badge è®¡æ•° [éªŒæ”¶: æ˜¾ç¤ºæœªè¯»æ•°é‡]'
    status: pending
  - id: p12-file-changes
    content: 'P12.2: å®ç° addFileChange() è¿½è¸ªæ–‡ä»¶ [éªŒæ”¶: æ–‡ä»¶åˆ—è¡¨æ›´æ–°]'
    status: pending
  - id: p12-progress-summary
    content: 'P12.3: å®ç° updateProgressSummary() [éªŒæ”¶: è¿›åº¦æ¡æ›´æ–°]'
    status: pending
  - id: p13-state-persist
    content: 'P13.2: å®ç° Tab çŠ¶æ€ localStorage æŒä¹…åŒ–'
    status: pending
---

# UIå‡çº§å­Plan 2: Tabé¢æ¿ç³»ç»Ÿå®Œæ•´åŠŸèƒ½

## æ¦‚è¿°

æœ¬å­Planå®ç°å³ä¾§è¾¹æ çš„Tabé¢æ¿ç³»ç»Ÿï¼ŒåŒ…å«è¿›åº¦ã€å·¥å…·è°ƒç”¨ã€æ–‡ä»¶å˜æ›´ä¸‰ä¸ªTabé¡µï¼Œæ”¯æŒé”®ç›˜å¯¼èˆªå’ŒçŠ¶æ€æŒä¹…åŒ–ã€‚

**ä»»åŠ¡æ•°é‡**: 17 ä¸ª
**é¢„ä¼°æ—¶é—´**: ~2.5 å°æ—¶
**ä¾èµ–**: å­Plan 1 (CSSå˜é‡ç³»ç»Ÿ)

## å‰ç½®æ¡ä»¶

- å­Plan 1 å·²å®Œæˆï¼ˆCSSå˜é‡ç³»ç»Ÿå¯ç”¨ï¼‰
- ä»¥ä¸‹CSSå˜é‡å·²å­˜åœ¨ï¼š
  - `--status-*` çŠ¶æ€è‰²å˜é‡
  - `--radius-*` åœ†è§’å˜é‡
  - `--shadow-*` é˜´å½±å˜é‡
  - `--transition-*` è¿‡æ¸¡å˜é‡

## ä¾èµ–å…³ç³»

```
P3.1-P3.5 Tab CSSæ ·å¼ (å¹¶è¡Œ)
  â†“
P8.1-P8.4 Tab HTMLç»“æ„
  â†“
P9.2 æ–‡ä»¶å˜æ›´ç©ºçŠ¶æ€
  â†“
P11.1-P11.4 Tab JSé€»è¾‘
  â†“
P12.2-P12.3 æ–‡ä»¶å˜æ›´/è¿›åº¦æ‘˜è¦JS
  â†“
P13.2 TabçŠ¶æ€æŒä¹…åŒ–
```

---

## Phase 3: Tab é¢æ¿æ ·å¼

**æ–‡ä»¶**: `renderer/style.css`

| ID   | ä»»åŠ¡                 | éªŒæ”¶æ ‡å‡†         |
| ---- | -------------------- | ---------------- |
| P3.1 | .panel-tabs å¯¼èˆªæ ·å¼ | Tab æŒ‰é’®æ’åˆ—æ­£ç¡® |
| P3.2 | Tab æ¿€æ´»çŠ¶æ€å’Œä¸‹åˆ’çº¿ | é€‰ä¸­æ€æœ‰ä¸‹åˆ’çº¿   |
| P3.3 | .tab-pane å†…å®¹åŒºæ ·å¼ | åˆ‡æ¢æ—¶éšè—/æ˜¾ç¤º  |
| P3.4 | è¿›åº¦æ‘˜è¦æ ·å¼         | è¿›åº¦æ¡æ­£ç¡®æ˜¾ç¤º   |
| P3.5 | æ–‡ä»¶å˜æ›´åˆ—è¡¨æ ·å¼     | å¢åˆ æ”¹æœ‰ä¸åŒé¢œè‰² |

### Tab CSSä»£ç 

```css
/* P3.1 Tabå¯¼èˆª */
.panel-tabs {
  display: flex;
  gap: 0;
  border-bottom: 1px solid var(--border-color);
  padding: 0 16px;
}

.panel-tabs button {
  flex: 1;
  padding: 12px 16px;
  background: transparent;
  border: none;
  color: var(--text-secondary);
  font-size: 13px;
  font-weight: 500;
  cursor: pointer;
  position: relative;
  transition: color var(--transition-fast);
}

.panel-tabs button:hover {
  color: var(--text-primary);
}

/* P3.2 æ¿€æ´»çŠ¶æ€ */
.panel-tabs button[aria-selected='true'] {
  color: var(--accent-color);
}

.panel-tabs button[aria-selected='true']::after {
  content: '';
  position: absolute;
  bottom: -1px;
  left: 0;
  right: 0;
  height: 2px;
  background: var(--accent-color);
  border-radius: 2px 2px 0 0;
}

/* Tab Badge */
.tab-badge {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-width: 18px;
  height: 18px;
  padding: 0 6px;
  margin-left: 6px;
  background: var(--status-info-bg);
  color: var(--status-info);
  font-size: 11px;
  font-weight: 600;
  border-radius: 9px;
}

.tab-badge:empty {
  display: none;
}

/* P3.3 Tabå†…å®¹åŒº */
.panel-content {
  flex: 1;
  overflow: hidden;
  position: relative;
}

.tab-pane {
  position: absolute;
  inset: 0;
  overflow-y: auto;
  padding: 16px;
  opacity: 1;
  transition: opacity var(--transition-fast);
}

.tab-pane[hidden] {
  display: block;
  opacity: 0;
  pointer-events: none;
}

/* P3.4 è¿›åº¦æ‘˜è¦ */
.progress-summary {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.progress-bar-container {
  background: var(--bg-tertiary);
  border-radius: var(--radius-sm);
  height: 8px;
  overflow: hidden;
}

.progress-bar {
  height: 100%;
  background: var(--accent-color);
  border-radius: var(--radius-sm);
  transition: width var(--transition-normal);
}

.progress-stats {
  display: flex;
  justify-content: space-between;
  font-size: 12px;
  color: var(--text-secondary);
}

/* P3.5 æ–‡ä»¶å˜æ›´åˆ—è¡¨ */
.file-changes-list {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.file-change-item {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  background: var(--bg-tertiary);
  border-radius: var(--radius-sm);
  font-size: 13px;
  font-family: 'SF Mono', Monaco, monospace;
}

.file-change-item .icon {
  width: 16px;
  text-align: center;
}

.file-change-item.added .icon {
  color: var(--status-success);
}
.file-change-item.modified .icon {
  color: var(--status-info);
}
.file-change-item.deleted .icon {
  color: var(--status-error);
}

.file-change-item .path {
  flex: 1;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.file-change-item .lines {
  font-size: 11px;
  color: var(--text-secondary);
}

.file-change-item .lines .added {
  color: var(--status-success);
}
.file-change-item .lines .removed {
  color: var(--status-error);
}
```

---

## Phase 8: HTML ç»“æ„

**æ–‡ä»¶**: `renderer/index.html`

| ID   | ä»»åŠ¡                       | éªŒæ”¶æ ‡å‡†         |
| ---- | -------------------------- | ---------------- |
| P8.1 | panel-tabs å¯¼èˆªç»“æ„ + ARIA | role=tablist     |
| P8.2 | è¿›åº¦ Tab å†…å®¹åŒº            | id=pane-progress |
| P8.3 | å·¥å…·è°ƒç”¨ Tab å†…å®¹åŒº        | id=pane-tools    |
| P8.4 | æ–‡ä»¶å˜æ›´ Tab å†…å®¹åŒº        | id=pane-files    |

### HTMLæ¨¡æ¿

```html
<!-- P8.1 Tab å¯¼èˆª + ARIA -->
<aside class="right-panel" role="complementary">
  <div class="panel-tabs" role="tablist" aria-label="è¯¦æƒ…é¢æ¿">
    <button
      role="tab"
      id="tab-progress"
      aria-selected="true"
      aria-controls="pane-progress"
      tabindex="0"
    >
      è¿›åº¦ <span class="tab-badge" id="badge-progress"></span>
    </button>
    <button
      role="tab"
      id="tab-tools"
      aria-selected="false"
      aria-controls="pane-tools"
      tabindex="-1"
    >
      å·¥å…· <span class="tab-badge" id="badge-tools"></span>
    </button>
    <button
      role="tab"
      id="tab-files"
      aria-selected="false"
      aria-controls="pane-files"
      tabindex="-1"
    >
      æ–‡ä»¶ <span class="tab-badge" id="badge-files"></span>
    </button>
  </div>

  <!-- P8.2-P8.4 Tab å†…å®¹åŒº -->
  <div class="panel-content">
    <!-- P8.2 è¿›åº¦ Tab -->
    <div id="pane-progress" role="tabpanel" aria-labelledby="tab-progress" class="tab-pane">
      <div class="progress-summary" id="progressSummary">
        <!-- è¿›åº¦å†…å®¹ç”±JSæ¸²æŸ“ -->
      </div>
    </div>

    <!-- P8.3 å·¥å…· Tab -->
    <div id="pane-tools" role="tabpanel" aria-labelledby="tab-tools" class="tab-pane" hidden>
      <div class="tool-calls-list" id="toolCallsList">
        <!-- å·¥å…·è°ƒç”¨åˆ—è¡¨ç”±JSæ¸²æŸ“ -->
      </div>
    </div>

    <!-- P8.4 æ–‡ä»¶ Tab -->
    <div id="pane-files" role="tabpanel" aria-labelledby="tab-files" class="tab-pane" hidden>
      <div class="file-changes-list" id="fileChangesList">
        <!-- æ–‡ä»¶å˜æ›´åˆ—è¡¨ç”±JSæ¸²æŸ“ -->
      </div>

      <!-- P9.2 ç©ºçŠ¶æ€ -->
      <div class="empty-state" id="filesEmpty">
        <div class="empty-icon">ğŸ“</div>
        <p>æš‚æ— æ–‡ä»¶å˜æ›´</p>
      </div>
    </div>
  </div>
</aside>
```

---

## Phase 9: æ–‡ä»¶å˜æ›´ç©ºçŠ¶æ€

| ID   | ä»»åŠ¡           | éªŒæ”¶æ ‡å‡†         |
| ---- | -------------- | ---------------- |
| P9.2 | æ–‡ä»¶å˜æ›´ç©ºçŠ¶æ€ | æ— å˜æ›´æ—¶æ˜¾ç¤ºæç¤º |

---

## Phase 11: Tab åˆ‡æ¢é€»è¾‘

**æ–‡ä»¶**: `renderer/uiHelpers.js`

| ID    | ä»»åŠ¡                 | éªŒæ”¶æ ‡å‡†         |
| ----- | -------------------- | ---------------- |
| P11.1 | switchTab() åˆ‡æ¢é€»è¾‘ | Tab åˆ‡æ¢æ­£å¸¸     |
| P11.2 | Tab é”®ç›˜å¯¼èˆª         | é”®ç›˜å¯åˆ‡æ¢ Tab   |
| P11.3 | Tab æ»šåŠ¨ä½ç½®ä¿æŒ     | åˆ‡æ¢å›æ¥ä½ç½®ä¸å˜ |
| P11.4 | Tab Badge è®¡æ•°       | æ˜¾ç¤ºæœªè¯»æ•°é‡     |

### æ ¸å¿ƒå‡½æ•°ç­¾å

```javascript
// Tabæ»šåŠ¨ä½ç½®ç¼“å­˜
const tabScrollPositions = {
  progress: 0,
  tools: 0,
  files: 0
};

// P11.1 Tabåˆ‡æ¢
export function switchTab(tabId) {
  // tabId: 'progress' | 'tools' | 'files'
  // 1. ä¿å­˜å½“å‰Tabæ»šåŠ¨ä½ç½®
  // 2. æ›´æ–°ARIAå±æ€§
  // 3. åˆ‡æ¢Tabæ˜¾ç¤º
  // 4. æ¢å¤ç›®æ ‡Tabæ»šåŠ¨ä½ç½®
}

// P11.2 é”®ç›˜å¯¼èˆª
export function initTabKeyboardNav() {
  // ç›‘å¬æ–¹å‘é”®ï¼Œåˆ‡æ¢Tabç„¦ç‚¹
  // Left/Up: å‰ä¸€ä¸ªTab
  // Right/Down: ä¸‹ä¸€ä¸ªTab
  // Home: ç¬¬ä¸€ä¸ªTab
  // End: æœ€åä¸€ä¸ªTab
}

// P11.3 æ»šåŠ¨ä½ç½®ä¿æŒ
function saveTabScrollPosition(tabId) {
  const pane = document.getElementById(`pane-${tabId}`);
  tabScrollPositions[tabId] = pane.scrollTop;
}

function restoreTabScrollPosition(tabId) {
  const pane = document.getElementById(`pane-${tabId}`);
  pane.scrollTop = tabScrollPositions[tabId];
}

// P11.4 Badgeè®¡æ•°
export function updateTabBadge(tabId, count) {
  const badge = document.getElementById(`badge-${tabId}`);
  badge.textContent = count > 0 ? count : '';
}
```

---

## Phase 12: æ–‡ä»¶å˜æ›´ä¸è¿›åº¦æ‘˜è¦

**æ–‡ä»¶**: `renderer/uiHelpers.js`

| ID    | ä»»åŠ¡                    | éªŒæ”¶æ ‡å‡†     |
| ----- | ----------------------- | ------------ |
| P12.2 | addFileChange()         | æ–‡ä»¶åˆ—è¡¨æ›´æ–° |
| P12.3 | updateProgressSummary() | è¿›åº¦æ¡æ›´æ–°   |

### æ ¸å¿ƒå‡½æ•°ç­¾å

```javascript
// P12.2 æ·»åŠ æ–‡ä»¶å˜æ›´
export function addFileChange(change) {
  // change: { path, type: 'added'|'modified'|'deleted', lines?: { added, removed } }
  // 1. æ›´æ–°fileChangesæ•°ç»„
  // 2. æ¸²æŸ“æ–‡ä»¶å˜æ›´é¡¹
  // 3. æ›´æ–°Badgeè®¡æ•°
  // 4. éšè—ç©ºçŠ¶æ€
}

// P12.3 æ›´æ–°è¿›åº¦æ‘˜è¦
export function updateProgressSummary(progress) {
  // progress: { completed, total, percentage, currentStep }
  // 1. æ›´æ–°è¿›åº¦æ¡å®½åº¦
  // 2. æ›´æ–°ç»Ÿè®¡æ–‡æœ¬
  // 3. æ›´æ–°å½“å‰æ­¥éª¤æè¿°
}
```

---

## Phase 13: çŠ¶æ€æŒä¹…åŒ–

| ID    | ä»»åŠ¡                         | éªŒæ”¶æ ‡å‡†          |
| ----- | ---------------------------- | ----------------- |
| P13.2 | Tab çŠ¶æ€ localStorage æŒä¹…åŒ– | åˆ·æ–°åæ¢å¤ä¸Šæ¬¡Tab |

```javascript
// ä¿å­˜å½“å‰Tab
function persistActiveTab(tabId) {
  localStorage.setItem('ui_active_tab', tabId);
}

// æ¢å¤ä¸Šæ¬¡Tab
function restoreActiveTab() {
  const savedTab = localStorage.getItem('ui_active_tab');
  if (savedTab && ['progress', 'tools', 'files'].includes(savedTab)) {
    switchTab(savedTab);
  }
}
```

---

## éªŒæ”¶æ£€æŸ¥æ¸…å•

å®Œæˆæœ¬å­Planåï¼Œé€é¡¹éªŒè¯ï¼š

- [ ] TabæŒ‰é’®æ’åˆ—æ­£ç¡®ï¼ˆè¿›åº¦/å·¥å…·/æ–‡ä»¶ï¼‰
- [ ] é€‰ä¸­Tabæœ‰ä¸‹åˆ’çº¿æŒ‡ç¤º
- [ ] Tabåˆ‡æ¢æ—¶å†…å®¹åŒºæ­£ç¡®æ˜¾ç¤º/éšè—
- [ ] é”®ç›˜å¯¼èˆªå¯ç”¨ï¼ˆæ–¹å‘é”®åˆ‡æ¢Tabç„¦ç‚¹ï¼‰
- [ ] Tab Badgeæ˜¾ç¤ºæœªè¯»æ•°é‡
- [ ] åˆ‡æ¢Tabåæ»šåŠ¨ä½ç½®ä¿æŒ
- [ ] æ–‡ä»¶å˜æ›´åˆ—è¡¨æ­£ç¡®æ˜¾ç¤ºï¼ˆå¢/åˆ /æ”¹æœ‰ä¸åŒé¢œè‰²ï¼‰
- [ ] è¿›åº¦æ‘˜è¦æ­£ç¡®æ˜¾ç¤ºï¼ˆè¿›åº¦æ¡+ç»Ÿè®¡ï¼‰
- [ ] ç©ºçŠ¶æ€æ­£ç¡®æ˜¾ç¤ºï¼ˆæ— æ–‡ä»¶å˜æ›´æ—¶ï¼‰
- [ ] åˆ·æ–°é¡µé¢åTabçŠ¶æ€æ¢å¤

## éªŒè¯å‘½ä»¤

```bash
# è¿è¡Œç›¸å…³E2Eæµ‹è¯•
npm run test:e2e -- --grep "Tab"

# æ‰‹åŠ¨éªŒè¯
# 1. å¯åŠ¨åº”ç”¨ï¼šnpm start
# 2. ç‚¹å‡»å„TabæŒ‰é’®éªŒè¯åˆ‡æ¢
# 3. æŒ‰æ–¹å‘é”®éªŒè¯é”®ç›˜å¯¼èˆª
# 4. åˆ·æ–°é¡µé¢éªŒè¯çŠ¶æ€æ¢å¤
```

---

## ä¸å…¶ä»–å­Plançš„æ¥å£

### ä¾èµ–ï¼ˆæ¥è‡ªå­Plan 1ï¼‰

- CSSå˜é‡ç³»ç»Ÿï¼ˆçŠ¶æ€è‰²ã€åœ†è§’ã€é˜´å½±ã€è¿‡æ¸¡ï¼‰

### æä¾›ï¼ˆç»™å­Plan 3ï¼‰

- Tabåˆ‡æ¢å‡½æ•° `switchTab()`
- Badgeæ›´æ–°å‡½æ•° `updateTabBadge()`
- è¿›åº¦æ‘˜è¦æ›´æ–°å‡½æ•° `updateProgressSummary()`
